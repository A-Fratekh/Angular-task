<!-- Header and Search Bar -->
<div class="d-flex flex-column flex-md-row justify-content-between align-items-center mb-3">
    <h1 class="mb-3 mb-md-0">Appraisals</h1>
    <app-search-bar (searchString)="onGlobalSearch($event)"> </app-search-bar>
</div>

<!-- Tabs -->
<app-nav-bar (tabSelected)="switchTabHandler($event)"></app-nav-bar>

<!-- Filter Row -->
 <ng-container *ngIf="selectedTab===selectedTabEnum.ForAppraisal || selectedTab===selectedTabEnum.ForReview">

<div class="d-flex flex-column flex-md-row align-items-center justify-content-between border-o rounded p-3 mb-4 filter">
    <div class="d-flex w-50 align-items-start mb-2 mb-md-0">
        <label class="me-2 mb-0">Show:</label>
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="filterOption" value="process" [(ngModel)]="filter">
            <label class="form-check-label">In process</label>
        </div>
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="filterOption" value="history" [(ngModel)]="filter">
            <label class="form-check-label">History</label>
        </div>
    </div>

    <div class="d-flex align-items-center gap-3">
        <div class="d-flex w-50 justify-content-center justify-content-md-start">
            <label class="form-label mb-0 me-2" for="appraisalType">Appraisal type:</label>
            <select id="appraisalType" class="form-select d-inline w-auto" [(ngModel)]="appraisalType"
                (change)="filterByAppraisalType()">
                <option value="">Select</option>
                <option *ngFor="let type of appraisalTypes" [value]="type">{{ type }}</option>
            </select>
        </div>
        <div *ngIf="filter === 'process'" class="d-flex w-100 justify-content-end">
            <label class="form-label mb-0 me-2" for="periodType">Period:</label>
            <select id="periodType" class="form-select d-inline w-auto" [(ngModel)]="periodType"
                (change)="filterByPeriodType()">
                <option value="">Select</option>
                <option *ngFor="let period of periodTypes" [value]="period">{{ period }}</option>
            </select>
        </div>
    </div>
</div>    
</ng-container>

<ng-container *ngIf="selectedTab===selectedTabEnum.ForPosting">
<div class="d-flex flex-column flex-md-row align-items-center justify-content-between border-0 rounded p-3 mb-4 filter">
    <div class="d-flex align-items-center gap-3">
        <div class="d-flex w-100 align-items-center">
            <label class="form-label w-100 mb-0 me-2" for="appraisalType">Admin unit:</label>
            <select id="appraisalType" class="form-select d-inline w-auto" [(ngModel)]="adminUnit"
                (change)="filterByAdminUnit()">
                <option value="">Select</option>
                <option *ngFor="let type of adminUnits" [value]="type">{{ type }}</option>
            </select>
        </div>
    </div>
</div>
</ng-container>

<ng-container *ngIf="selectedTab===selectedTabEnum.ForAppraisal || selectedTab===selectedTabEnum.ForReview">
    <!-- Card View -->
    <app-card-view [items]="filteredList" [view]="filter" [headerTemplate]="cardHeader" [bodyTemplate]="cardBody" [selectedTab]="selectedTabStr"
        [footerTemplate]="cardFooter" (startAppraisal)="startAppraisalHandler($event)"
        (continueAppraisal)="continueAppraisalHandler($event)" (reviewAppraisal)="reviewAppraisalHandler($event)"
        >

    </app-card-view>

    <!-- Card Header -->
    <ng-template #cardHeader let-data>
        <div class="d-flex justify-content-between align-items-start">
            <div>
                <div class="text-muted small">{{ data.cpdua }}</div>
                <div class="d-flex align-items-center mt-2">
                    <img [src]="data.image" alt="Avatar" class="rounded-circle me-2" width="36" height="36">
                    <div>
                        <div class="fw-semibold">{{ data.id }} | {{ data.name }}</div>
                        <div class="text-muted small">{{ data.role }}</div>
                    </div>
                </div>
            </div>
        </div>
    </ng-template>

    <!-- Card Body -->
    <ng-template #cardBody let-data>
        <div class="mt-3">
            <div class="mb-2">
                <i class="fa fa-clipboard-check me-2 text-secondary"></i>{{ data.reviewTitle }}
            </div>
            <div>
                <i class="fa fa-calendar-event me-2 text-secondary"></i>
                <span [ngClass]="{ 'text-danger': data.overdue, 'text-muted': !data.overdue }">
                    {{ data.dueText }} {{ data.dueIn }}
                </span>
            </div>
        </div>
    </ng-template>

    <!-- Card Footer handled inside component -->
    <ng-template #cardFooter let-item></ng-template>
</ng-container>
<ng-container *ngIf="selectedTab === selectedTabEnum.ForPosting">
    <app-grid-view [items]="filteredList" [adminUnits]="adminUnits" 
        >
    </app-grid-view>
</ng-container>